`use strict`;

const fs = require(`fs-extra`);
const checkDirname = require(`${__dirname}/../helper/checkDirname.js`);

function forEachSync(_this, dir, callback, filter) {

  checkDirname(dir);

  let fileDir = `${_this.dir}/${dir}`;

  let filesRaw = fs.readdirSync(fileDir);

  if (filter) {
    for (let i = 0; i < filesRaw.length; i++) {
      const f = filesRaw[i];
      const filePath = `${fileDir}/${f}`;
      const json = fs.readJsonSync(filePath);
      const file = f.substring(0, f.length - 5);
      if (filter(json, file)) {
        callback(json, file);
      }
    }
  } else {
    for (let i = 0; i < filesRaw.length; i++) {
      const f = filesRaw[i];
      const filePath = `${fileDir}/${f}`;
      callback(fs.readJsonSync(filePath), f.substring(0, f.length - 5));
    }
  }


}

module.exports = forEachSync;