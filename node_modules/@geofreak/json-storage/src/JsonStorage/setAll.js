`use strict`;

const fs = require(`fs-extra`);
const checkFilename = require(`${__dirname}/../helper/checkFilename.js`);
const checkDirname = require(`${__dirname}/../helper/checkDirname.js`);

async function setAll(_this, arg1, arg2) {

  if (arg1) {
    
    if (arg2) {
      // set dir
      checkDirname(arg1);
      await fs.ensureDir(`${_this.dir}/${arg1}`);
      for (const key in arg2) {
        checkFilename(key);
        await fs.writeJson(`${_this.dir}/${arg1}/${key}.json`, arg2[key], _this.options);
      }
      if(_this.options.git){
        await _this.git.add(`"${_this.dir}/${arg1}"`);
        await _this.git.commit(`"${_this.dir}/${arg1}"`, `setAll: ${arg1}`);
      }
    } else {
      // set storage
      for (const dir in arg1) {
        checkDirname(dir);
        await fs.ensureDir(`${_this.dir}/${dir}`);
        for (const file in arg1[dir]) {
          checkFilename(file);
          await fs.writeJson(`${_this.dir}/${dir}/${file}.json`, arg1[dir][file], _this.options);
        }
      }
      if(_this.options.git){
        await _this.git.add(`.`);
        await _this.git.commit(``, `setAll: complete storage`);
      }
    }
  }

}

module.exports = setAll;