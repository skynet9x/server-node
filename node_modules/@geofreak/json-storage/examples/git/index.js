`use strict`;

const JsonStorage = require(`${__dirname}/../../index.js`);

// init storage
const store = new JsonStorage(`${__dirname}/storage`, {
  git: true
});

store.setSync(`cars`, `set_sync_car001`, { name: `VW Golf 1` });
store.setSync(`cars`, `set_sync_car002`, { name: `VW Golf 2` });
store.setSync(`cars`, `set_sync_car003`, { name: `VW Golf 3` });
store.setSync(`cars`, `set_sync_car004`, { name: `VW Golf 4` });
store.setSync(`cars`, `set_sync_car005`, { name: `VW Golf 5` });

store.renameSync(`cars`, `set_sync_car005`, `set_sync_car999`);

store.setSync(`myusers_sync`, `set_sync_user001`, { name: `Tom` });
store.setSync(`myusers_sync`, `set_sync_user002`, { name: `John` });
store.renameSync(`myusers_sync`, `users_sync`);

// create backup
const allSync = store.getAllSync();

store.removeSync(`cars`, `set_sync_car004`);
store.removeSync(`users_sync`);

store.setSync(`dogs`, `set_sync_dog001`, { name: `Bruno` });
store.setSync(`dogs`, `set_sync_dog002`, { name: `Felix` });
store.emptySync(`dogs`);

setTimeout(() => {
  store.emptySync();
  store.setAllSync(allSync);
  store.setAllSync(`cats`, {
    cat001: { name: `Tim` },
    cat002: { name: `Tom` }
  });
}, 10000);

(async () => {
  await store.set(`cars`, `set_async_car001`, { name: `VW Golf 1` });
  await store.set(`cars`, `set_async_car002`, { name: `VW Golf 2` });
  await store.set(`cars`, `set_async_car003`, { name: `VW Golf 1` });
  await store.set(`cars`, `set_async_car004`, { name: `VW Golf 2` });
  await store.set(`cars`, `set_async_car005`, { name: `VW Golf 1` });

  await store.rename(`cars`, `set_async_car005`, `set_async_car999`);

  await store.set(`myusers_async`, `set_async_user001`, { name: `Tom` });
  await store.set(`myusers_async`, `set_async_user002`, { name: `John` });
  await store.rename(`myusers_async`, `users_async`);

  await store.remove(`cars`, `set_async_car004`);

  await store.remove(`users_async`);

  await store.set(`dogs`, `set_async_dog001`, { name: `Bruno` });
  await store.set(`dogs`, `set_async_dog002`, { name: `Felix` });
  await store.empty(`dogs`);

  setTimeout(async () => {
    await store.empty();
    await store.setAll(allSync);
    await store.setAll(`cats`, {
      cat001: { name: `Tim` },
      cat002: { name: `Tom` }
    });
  }, 20000);
})();
