`use strict`;

const JsonStorage = require(`${__dirname}/../../index.js`);

// init storage
const store = new JsonStorage(`${__dirname}/storage`);

function speedtestSync(numberOfFiles) {
  console.time(`setSync ${numberOfFiles} files`);
  for (let i = 0; i < numberOfFiles; i++) {
    store.setSync(`set_sync_${numberOfFiles}`, `file${i}`, { id: i });
  }
  console.timeEnd(`setSync ${numberOfFiles} files`);

  console.time(`forEachSync ${numberOfFiles} files`);
  store.forEachSync(`set_sync_${numberOfFiles}`, (file, json) => {
    //console.log(file,json);
  });
  console.timeEnd(`forEachSync ${numberOfFiles} files`);

  console.time(`getSync 1 file`);
  store.getSync(`set_sync_${numberOfFiles}`, `file0`);
  console.timeEnd(`getSync 1 file`);
}

async function speedtest(numberOfFiles) {
  console.time(`set ${numberOfFiles} files`);
  for (let i = 0; i < numberOfFiles; i++) {
    await store.set(`set_${numberOfFiles}`, `file${i}`, { id: i });
  }
  console.timeEnd(`set ${numberOfFiles} files`);

  console.time(`forEach ${numberOfFiles} files`);
  await store.forEach(`set_${numberOfFiles}`, (file, json) => {
    //console.log(file,json);
  });
  console.timeEnd(`forEach ${numberOfFiles} files`);

  console.time(`get 1 file`);
  await store.get(`set_${numberOfFiles}`, `file0`);
  console.timeEnd(`get 1 file`);
}

let numberOfFiles = 1000;
if (process.argv[2]) {
  numberOfFiles = process.argv[2];
}

console.log(`--sync-------------------------------------------`);
speedtestSync(numberOfFiles);
console.log(`-------------------------------------------------`);

(async () => {
  console.log(`--async------------------------------------------`);
  await speedtest(numberOfFiles);
  console.log(`-------------------------------------------------`);
})();
